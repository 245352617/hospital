## 价格的计算：
**药品：**
不拆包装：总价=大包装价格x数量
可拆包装：总价=小包装价格x数量
自备药：总价=0；

**检查：**
项目有单价：项目总价=项目单价
项目没有单价：项目总价=子项单价x子项数量 的价格之和
检验：
同检查规则

**诊疗项目：**
总价=单价x数量
南医特殊需求：<=6岁加价30%
总价=儿童价x数量

**药品：**

根据剂量算数量：

0最小单位总量取整  1包装单位总量取整  2最小单位每次取整 3包装单位每次取整 
0：
剂量单位：数量=Convert.ToInt32(Math.Ceiling(开的剂量/规格剂量*频次系数*天数))
小包装单位：数量=Convert.ToInt32(Math.Ceiling(开的剂量*频次系数*天数))
大包装单位：数量=Convert.ToInt32(Math.Ceiling(开的剂量*小包装拆零系数*频次系数*天数))
1：
剂量单位：数量=Convert.ToInt32(Math.Ceiling(开的剂量/规格剂量*频次系数*天数/小包装拆零系数))
小包装单位：数量=Convert.ToInt32(Math.Ceiling(开的剂量*频次系数*天数/小包装拆零系数))
大包装单位：数量=Convert.ToInt32(Math.Ceiling(开的剂量*频次系数*天数))

2和3:
剂量单位：数量=Convert.ToInt32(Math.Ceiling(开的剂量/规格剂量)*频次系数*天数)
小包装单位：数量=Convert.ToInt32(Math.Ceiling(开的剂量)*频次系数*天数)
大包装单位：数量=Convert.ToInt32(Math.Ceiling(开的剂量*小包装拆零系数)*频次系数*天数)


实际天数的计算：
大包装单位：
实际天数=Convert.ToInt32(Math.Ceiling(数量*规格剂量*小包装拆零系数 /(开的剂量*频次系数)))
小包装单位：
实际天数=Convert.ToInt32(Math.Ceiling(数量*规格剂量*大包装拆零系数 /(开的剂量*频次系数)))

根据数量算剂量：
药品：
0最小单位总量取整  1包装单位总量取整  2最小单位每次取整 3包装单位每次取整 
0：
剂量单位：开的剂量=Convert.ToInt32(Math.Ceiling(数量*规格剂量/频次系数/天数))
小包装单位：开的剂量=Convert.ToInt32(Math.Ceiling(数/频次系数/天数))
大包装单位：开的剂量=Convert.ToInt32(Math.Ceiling(数量/包装拆零系数/频次系数/天数))
1：
剂量单位：开的剂量=Convert.ToInt32(Math.Ceiling(数量*小包装拆零系数*规格剂量/频次系数/天数))
小包装单位：开的剂量=Convert.ToInt32(Math.Ceiling(数量*小包装拆零系数/频次系数*天数))
大包装单位：开的剂量=Convert.ToInt32(Math.Ceiling(数量/频次系数/天数))

2和3:
剂量单位：开的剂量=Convert.ToInt32(Math.Ceiling(数量*规格剂量)/频次系数/天数)
小包装单位：开的剂量=Convert.ToInt32(Math.Ceiling(数量)/频次系数/天数)
大包装单位：开的剂量=Convert.ToInt32(Math.Ceiling(数量/小包装拆零系数)/频次系数/天数)


限制性用药规则：
医保病人 甲乙类药品开药天数<=3天
判断 同一天、同一个病人、同一个药品、同一个用法是否用药重复
判断 同一个病人、同一个药品、不在同一天但在药品还未使用完事再次开立同样药品是否用药重复
处方数量<=5
判断医保适应症

处方开立规则：



*** 一、输入：病人费别（自费、医保）、慢病标识（此标识一般在诊断字典里）、登录用户属性*** 

​        慢性病默认开药天数<=7天
​        医保病人默认开药天数<=3天
​        自费病人默认开药天数<=30天

注意：每家医院要求有所不同，最好做成配置



 *** 二、 处方、抗生素权限：*** 

​     输入：用户表，药品字典

​     用户属性：无处方权、有处方权

无处方权：不是医生无处方权，是医生根据用户属性判断有无处方权

 有处方权：

1.含精二及以下处方权（第二类精神药品、普通药等）

2.麻精一及以下处方权（毒性药品、麻醉药品、第一类精神药品、第二类精神药品、普通药等）

抗生素权：

用户表有抗生素权限登记（一般是3级）

针对抗生素药品有几级抗生素，处理逻辑，比对大小。



***  三、预留合理用药外部接口，针对每次开立的医嘱，在保存时进行验证*** 



***  四、预留库存接口，针对每次开药从外部系统获取当前药品是否有库存，没有库存不允许开立。*** 



***  五、作废医嘱规则：不同类型医嘱分开作废。*** 



***  六、药品医嘱需支持拆顿或者不拆顿配置：根据医院需求配置*** 

​       拆顿规则参考重症拆顿逻辑



***  七、业务表预留电子签章存储字段*** 



***  八、自动分方*** 



检查开立规则：

检查申请页面  开立规则：
             \* 不同的科室的检查项目必须分单开立
             \* 检查申请单格式不同的项目必须分单开立
             \* X线和B超 一张单子不能同时出现2条
             *
             \* 每位患者一张CT不能超过2个检查项目
             \* 每位患者一张MRI只允许开立1个检查项目

​             *检查项目与执行科室是动态关联关系
​             *允许重复(已提交可以)

  



检验开立规则：

​             *未提交项不允许重复开立

​             *检验项目与标本、执行科室、容器是动态关联关系







​          

